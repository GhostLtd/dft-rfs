{% extends 'domestic_survey/base.html.twig' %}

{% block content %}
    {% import '@GhostGovUkFrontend/components/component-macros.html.twig' as gdsComponents %}
    <h1 class="page-heading__heading govuk-heading-xl">CSRGT summary</h1>

    {% if domesticSurvey.initialDetailsComplete and domesticSurvey.businessAndVehicleDetailsComplete %}
        <h2 class="govuk-heading-m">Your survey week</h2>
        <dl class="govuk-summary-list govuk-!-margin-bottom-9">
            {% for dayNumber in 1..7 %}
                {% set day = domesticSurvey.response.dayByNumber(dayNumber) %}
                {{ gdsComponents.summaryListRow(
                    "Day #{dayNumber} (#{(domesticSurvey.startDateModifiedBy('+' ~ (dayNumber-1) ~ ' day')) | date ('l, jS M')})",
                    day ? _self.dayText(day) : 'Nothing recorded',
                    {(url('app_domesticsurvey_day_view', {dayNumber: dayNumber})): day ? 'Change' : 'Add'}
                ) }}
            {% endfor %}
        </dl>
        <p class="govuk-body">
            <a href="{{ url('app_domesticsurvey_contactdetails') }}">View/change the contact, business and vehicle details you have already entered</a>.
        </p>
    {% endif %}

    {% if domesticSurvey.initialDetailsComplete %}
        <p class="govuk-body">
            When you have finished entering information for your survey week, you must submit your survey.
        </p>
        <p class="govuk-body">
            <a class="govuk-button" data-module="govuk-button" href="{{ url('app_domesticsurvey_index') }}">Submit your survey</a>
        </p>

    {% endif %}
{% endblock %}

{% macro dayText(day) -%}
    {{- (day.hasMoreThanFiveStops
        ? ('More than 5 stops' ~ ((day.summary | default(false))
            ? " (#{day.summary.originLocation} to #{day.summary.destinationLocation})"
            : ' (incomplete)'
        ))
        : '5 stops of fewer'
    ) -}}
{%- endmacro %}