{% set translation_prefix = 'international.trip.summary' %}
{% extends 'international_survey/base.html.twig' %}

{% macro actionHelp() %}
    <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">{{ 'international.trip.summary.help.action-what'|trans }}</span>
        </summary>
        <div class="govuk-details__text">{{ 'international.trip.summary.help.action-explanation'|trans|nl2br }}</div>
    </details>
{% endmacro %}

{% block content %}
    {%- from '@GhostGovUkFrontend/components/macros.html.twig' import summaryListRow, actionLinks, tableHead, tableCell -%}

    <h1 class="page-heading__heading govuk-heading-xl">{{ 'international.trip.summary.trip-summary'|trans }}</h1>

    {%- with {marginBottom: 5} -%}
        {%- include "international_survey/includes/trip.html.twig" -%}
    {%- endwith -%}

    <div class="govuk-!-margin-bottom-9">
        <a class="govuk-button govuk-button--warning" href="{{ path('app_internationalsurvey_trip_delete', {tripId: trip.id}) }}">Delete trip</a>
    </div>

    {%- set dashboardRoute = constant('App\\Controller\\InternationalSurvey\\VehicleController::VEHICLE_ROUTE') -%}
    {% if is_feature_enabled('IRHS_CONSIGNMENTS_AND_STOPS') %}
        {# -------------------------------------------------------------------------------- #}
        {# Stops and consignments #}
        {# -------------------------------------------------------------------------------- #}
        {%- if trip.consignments is not empty -%}
            {%- include "international_survey/includes/consignments.html.twig" -%}
        {%- endif -%}

        {%- if trip.stops is empty or trip.consignments is empty -%}
            <h2 class="govuk-heading-m">{{ 'common.headings.next-steps'|trans }}</h2>
        {%- endif -%}
        <p class="govuk-body">
            {%- if trip.stops is empty -%}
                {%- set addStopRoute = constant('App\\Controller\\InternationalSurvey\\StopController::ADD_ROUTE') -%}
                <a class="govuk-button"
                   href="{{ url(addStopRoute, {tripId: trip.id}) }}">{{ 'international.trip.summary.actions.add-stops'|trans }}</a>
            {%- else -%}
                {%- set addConsignmentRoute = constant('App\\Controller\\InternationalSurvey\\ConsignmentWorkflowController::START_ROUTE') -%}
                <a class="govuk-button"
                   href="{{ url(addConsignmentRoute, {tripId: trip.id, consignmentId: 'add'}) }}">{{ 'international.trip.summary.actions.add-consignment'|trans }}</a>
            {%- endif -%}
            <a href="{{ url(dashboardRoute, {vehicleId: trip.vehicle.id}) }}"
               class="govuk-button govuk-button--secondary">{{ 'international.trip.summary.actions.back-to-vehicle-summary'|trans }}</a>
        </p>
    {% else %}
        {# -------------------------------------------------------------------------------- #}
        {# Loading/Unloading Actions #}
        {# -------------------------------------------------------------------------------- #}
        {%- import _self as s -%}
        {%- if trip.actions is empty -%}
            <h2 class="govuk-heading-m">{{ 'common.headings.next-steps'|trans }}</h2>
            {{ s.actionHelp() }}
        {%- else -%}
            {%- set showReorderLink = trip.actions | length > 1 -%}

            <h2 class="page-heading__heading govuk-heading-l">{{ 'international.trip.summary.action'|trans }}</a></h2>
            {{ s.actionHelp() }}
            {%- with {
                bottomMargin: showReorderLink ? '2' : '6',
                trip: trip,
            } -%}
                {%- include "international_survey/includes/actions.html.twig" -%}
            {%- endwith -%}

            {%- if showReorderLink %}
                <div class="govuk-!-margin-bottom-6 govuk-body">
                    {%- set reorderRoute = constant('App\\Controller\\InternationalSurvey\\ActionController::REORDER_ROUTE') -%}
                    <a href="{{ url(reorderRoute, {tripId: trip.id}) }}"
                       class="govuk-link">{{ 'common.actions.re-order-actions'|trans }}</a>
                </div>
            {% endif %}
        {%- endif -%}
        <p class="govuk-body">
            {%- set addActionRoute = constant('App\\Controller\\InternationalSurvey\\ActionController::START_ROUTE') -%}
            {%- set dashboardUrl = url(dashboardRoute, {vehicleId: trip.vehicle.id}) -%}
            <a href="{{ url(addActionRoute, {tripId: trip.id}) }}" class="govuk-button">{{ 'international.trip.summary.actions.add-action'|trans }}</a>
            <a href="{{ dashboardUrl }}" class="govuk-button">{{ 'international.trip.summary.actions.trip-complete'|trans }}</a>
            <a href="{{ dashboardUrl }}" class="govuk-button govuk-button--secondary">{{ 'international.trip.summary.actions.back-to-vehicle-summary'|trans }}</a>
        </p>
    {% endif %}
{% endblock %}